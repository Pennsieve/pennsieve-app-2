<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">

<link rel="import" href="../../../../styles/blackfynn/main.html">

<!--
# bf-overflow-popup
Component that displays the full copy of a truncated item

@element bf-overflow-popup
@demo demo/bf-overflow-popup.html
-->

<dom-module id="bf-overflow-popup">
  <style include="blackfynn-main-styles"></style>
  <style>
    :host {
      background: white;
	    border: 1px solid #BDBDBD;
      border-radius: 2px;
      box-shadow: 0 4px 6px 0 rgba(64,69,84,0.4);
      color: var(--glial);
      max-height: 300px;
      max-width: 500px;
      padding: 10px;
      position: absolute !important;
      word-break: break-all;
    }
    #contenWrap {
      overflow-x: hidden;
      overflow-y: scroll;
    }
    #arrow {
      bottom: auto;
      position: absolute;
      top: -6px;
    }
    #arrow[bottom] {
      bottom: 0;
      top: auto;
    }
    #arrow[bottom]::before, #arrow[bottom]::after {
      border-width: 5px 5px 0 5px;
      border-color: var(--white-matter) transparent transparent transparent;
    }
    #arrow[bottom]::before {
      border-width: 6px 6px 0 6px;
      border-color: #8a8a8a transparent transparent transparent;
      top: 0
    }
    #arrow[bottom]::after {
      top: 0
    }
    #arrow::before, #arrow::after {
      border-style: solid;
      border-width: 0 5px 5px 5px;
      border-color: transparent transparent var(--white-matter) transparent;
      content: '';
      position: absolute;
      left: 1px;
      top: 1px;
    }
    #arrow::before {
      border-style: solid;
      border-width: 0 6px 6px 6px;
      border-color: transparent transparent #8a8a8a transparent;
      left: 0;
      top: 0;
    }
  </style>
  <template>
    <div id="contentWrap"><div id="content">[[content]]</div></div>
    <div id="arrow" bottom$="[[arrowBottom]]"></div>
  </template>
  <script>
    Polymer({
      is: 'bf-overflow-popup',

      behaviors: [
        Polymer.IronOverlayBehavior
      ],

      properties: {
        /**
         * Content that appears in the popup
         */
        content: {
          type: String
        },
        /**
         * Position of the arrow
         */
        arrowBottom: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'iron-overlay-opened': 'positionArrow'
      },

      /**
       * Position the arrow based on the positioning of the popup
       */
      positionArrow: function() {
        if(this.opened && !this.__isAnimating) {
          const targetPos = this.positionTarget.getBoundingClientRect();
          const thisPos = this.getBoundingClientRect();
          const arrow = this.$.arrow;

          if(targetPos.top < thisPos.top) {
            this.set('arrowBottom', false);
          } else {
            this.set('arrowBottom', true);
          }

          arrow.style.left = targetPos.left - thisPos.left + arrow.scrollWidth / 2 + 'px';
        }
      }
    });
  </script>
</dom-module>
