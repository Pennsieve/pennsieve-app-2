<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../shared/bf-viewer-package-title.html">
<link rel="import" href="../../shared/show-pkg-title-behavior.html">
<link rel="import" href="../static-viewer-behavior.html">


<dom-module id="bf-viewer-video">
  <template>
    <style type="text/css">
      :host {
        height: 100%;
        width: 100%;
        @apply(--layout-vertical);
        @apply(--layout-flex);
      }
      .video-viewer {
        border: none;
        height: 100%;
        width: 100%;
      }
    </style>

    <template is="dom-if" if="[[showPkgTitle]]">
      <bf-viewer-package-title
        is-active="[[isActive]]"
        title="[[data.name]]"></bf-viewer-package-title>
    </template>

    <video class="video-viewer" src="[[getFileUrl]]" autoplay controls></video>

    <iron-ajax
      auto
      id="getViewerData"
      method="GET"
      url="[[getViewerDataUrl]]"
      loading="{{isLoadingViewerData}}"
      content-type="application/json"
      handle-as="json"
      on-response="_handleGetViewerData"
      on-error="ajaxError"></iron-ajax>

  </template>

  <script>
    Polymer({
      is: 'bf-viewer-video',

      behaviors: [
        Blackfynn.StaticViewerBehavior,
        Blackfynn.ShowPkgTitleBehavior
      ],

      ajaxError: function(e, detail) {
        this.fire('ajaxError', { status: detail.request.status });
      },

      _handleGetViewerData: function(e, detail) {
        const pkg = R.reject(R.pathEq(['content', 'fileType'], 'PNG'), detail.response)
        const viewerDataId = R.pathOr('', [0, 'content', 'id'])(pkg)

        if (viewerDataId) {
          this.set('viewerDataId', viewerDataId);
        }
      }
    });
  </script>
</dom-module>
