<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../shared/bf-viewer-package-title.html">
<link rel="import" href="../../shared/bf-ajax-behavior.html">
<link rel="import" href="../../shared/show-pkg-title-behavior.html">
<link rel="import" href="../static-viewer-behavior.html">

<script type="text/javascript" src="lib/papaya.js"></script>
<dom-module id="bf-viewer-mri">
  <template>
    <style type="text/css">
      :host {
        background-color: black;
        height: calc(100vh - 48px);
        position: relative;
        width: 100%;
        @apply(--layout-vertical);
      }
      ::content .papaya-viewer, .papaya-viewer {
        left: 0;
        position: absolute;
        top: 48px;
      }
      ::content .papaya-display, .papaya-display {
        left: 0;
        position: absolute;
        top: 0;
        z-index: 2;
      }
      .viewer {
        position: relative;
      }
    </style>

    <template is="dom-if" if="[[showPkgTitle]]">
      <bf-viewer-package-title
        is-active="[[isActive]]"
        title="[[data.name]]"></bf-viewer-package-title>
    </template>

    <div class="viewer">
      <div id="papayaCont">
        <div class="papaya" data-params="[[dataParams]]"></div>
      </div>
    </div>

    <iron-ajax
      auto
      id="getViewerData"
      method="GET"
      url="[[getViewerDataUrl]]"
      loading="{{isLoadingViewerData}}"
      content-type="application/json"
      handle-as="json"
      on-response="_handleGetViewerData"
      on-error="ajaxError"></iron-ajax>

  </template>

  <script>
    Polymer({
      is: 'bf-viewer-mri',

      behaviors: [
        Polymer.IronResizableBehavior,
        Blackfynn.StaticViewerBehavior,
        Blackfynn.AjaxBehavior,
        Blackfynn.ShowPkgTitleBehavior
      ],

      properties: {
        viewerDataId: {
          observer: '_viewerDataChanged',
          type: String,
          value: undefined
        },
        dataParams:{
          type: Object,
          value: {
            images: [],
            kioskMode: true
          }
        }
      },

      listeners: {
        'iron-resize': 'resizeViewer'
      },

      resizeViewer: function() {
        papaya.Container.resizePapaya();
      },

      attached: function() {
        papaya.Container.startPapaya();
      },

      _viewerDataChanged: function(e) {
        if(e) {
          this.set('dataParams.images', [this.getFileUrl]);
          papaya.Container.addViewer($(this.$.papayaCont), {images: [this.getFileUrl], kioskMode: true, showControls: false, showControlBar: false});
        }
      },

    });
  </script>
</dom-module>
