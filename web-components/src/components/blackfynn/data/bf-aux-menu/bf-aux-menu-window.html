<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../../bower_components/iron-overlay-behavior/iron-overlay-behavior.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-icon-item.html">

<link rel="import" href="../../shared/blackfynn-menu.html">
<link rel="import" href="../../shared/blackfynn-menu-item.html">
<link rel="import" href="../../shared/bf-menu-heading.html">

<link rel="import" href="../../../../styles/blackfynn/main.html">
<link rel="import" href="../../../../styles/blackfynn/icons.html">


<dom-module id="bf-aux-menu-window">

  <template>
    <style include="blackfynn-main-styles"></style>
    <style>
      :host {
        bottom: 1px;
        color: #000;
        display: block;
        right: 109px;
        max-width: none !important;
        min-width: 190px;
        position: absolute;
        text-align: left;
        transform: translateY(100%);
      }
      :host([offscreen]) {
        left: auto;
        right: -13px;
      }
      :root {
        --paper-item-icon-width: 36px;
        --paper-item-icon: {
          color: var(--blackfynn-blue);
        }
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      h3 {
        font-size: 15px;
        margin-bottom: 5px;
      }
      paper-card {
        width: 200px;
      }
      paper-icon-item:hover {
        background-color: var(--paper-grey-200);
        cursor: pointer;
      }
      blackfynn-menu {
        bottom: -11px;
        position: relative;
        left: -50%;
      }
    </style>

    <blackfynn-menu id="menu" hidden$="[[!opened]]">
      <a href="#" id="createCollectionButton" tabindex="-1" on-tap="toggleCreateCollection">
        <blackfynn-menu-item icon="blackfynn:folder">New Collection</blackfynn-menu-item>
      </a>

      <a href="#" id="uploadFilesButton" tabindex="-1" on-tap="toggleUploader">
        <blackfynn-menu-item icon="blackfynn:upload">Upload Files</blackfynn-menu-item>
      </a>
    </blackfynn-menu>
  </template>

  <script>
    Polymer({
      is: 'bf-aux-menu-window',

      behaviors: [
        Polymer.IronOverlayBehavior
      ],

      properties: {
        /**
         * flag that determines whether or not menu will appear offscreen
         */
        offscreen: {
          type: Boolean,
          value: false,
          reflectToAttribute: true
        },
      },

      listeners: {
        'iron-overlay-opened': 'positionWindow'
      },

      /**
       * Dynamically positions window to prevent it from going offscreen
       */
      positionWindow: function() {
        // Reposition the window if needed
        const width = this.getBoundingClientRect().width;
        const widthParent = this.positionTarget.getBoundingClientRect().width;
        const newBtn = this.positionTarget.$.newButton;
        const menu = this.$.menu;
        if(width > widthParent) {
          this.set('offscreen', true);
        } else {
          this.set('offscreen', false);
          menu.set('center', true);
          menu.style.left = `${newBtn.getBoundingClientRect().width / 2}px`;
        }
      },

      /**
       * Hide this menu window
       */
      closeWindow: function() {
        this.close();
      },

      /**
       * Dispatches event to data-catalog view to toggle create collection modal
       */
      toggleCreateCollection: function(e) {
        this.fire('data-catalog-event', {
          methodName: 'openCollectionDialog'
        });
        this.closeWindow();
      },

      /**
       * Dispatches event to data-catalog view to toggle upload modal
       */
      toggleUploader: function() {
        this.fire('open-uploader', { isAddingFiles: true });
        this.closeWindow();
      },

    });
  </script>

</dom-module>
