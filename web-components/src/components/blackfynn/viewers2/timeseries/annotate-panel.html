<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../../../styles/blackfynn/icons.html">
<link rel="import" href="../../../../styles/blackfynn/main.html">
<link rel="import" href="../../shared/bf-ajax-behavior.html">
<link rel="import" href="../../shared/color-behavior.html">
<link rel="import" href="../../shared/isPlugin-behavior.html">
<link rel="import" href="../../shared/bf-logger/bf-logger-behavior.html">
<link rel="import" href="../../shared/item-icon-behavior.html">
<link rel="import" href="../../shared/vuex-behavior/vuex-behavior.html">
<link rel="import" href="canvas/data-behavior.html">
<link rel="import" href="canvas/annotation-behavior.html">
<link rel="import" href="../../data/property.html">

<dom-module id="blackfynn-viewer-timeseries-annotate-panel">
  <template>
    <style include="blackfynn-main-styles"></style>
    <style type="text/css">

    </style>

      <iron-ajax
        id="delAnnotationAjax"
        method="DELETE"
        url="[[mainAnnDataUrl]]"
        content-type="application/json"
        handle-as="json"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="addAnnotationAjax"
        method="POST"
        url="[[mainAnnDataUrl]]"
        content-type="application/json"
        handle-as="json"
        on-response="_addAnnResponse"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="updateAnnotationAjax"
        method="PUT"
        url="[[mainAnnDataUrl]]"
        content-type="application/json"
        handle-as="json"
        on-response="_updateAnnResponse"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="getAnnotationAjax"
        method="GET"
        url="[[getAnnDataUrl]]"
        content-type="application/json"
        handle-as="json"
        on-response="_getAnnResponse"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="getLayersAjax"
        method="GET"
        url="[[getLayerUrl]]"
        content-type="application/json"
        handle-as="json"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="updateLayerAjax"
        method="PUT"
        content-type="application/json"
        handle-as="json"
        on-response="_updateLayerResponse"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="createLayerAjax"
        method="POST"
        url="[[getLayerUrl]]"
        content-type="application/json"
        handle-as="json"
        on-response="_createLayerResponse"
        on-error="ajaxError">
      </iron-ajax>

      <iron-ajax
        id="deleteLayerAjax"
        method="DELETE"
        url=""
        content-type="application/json"
        handle-as="json"
        on-error="ajaxError">
      </iron-ajax>

    </template>


  <script>

      Polymer({

          is: 'blackfynn-viewer-timeseries-annotate-panel',

          properties: {

              parent: {
                  type: Object,
                  value: null
              },
              viewer: {
                  type: Object,
                  value: null
              },
              annLayers:{
                  type: Array,
                  value: function() { return []; },
                  notify: true
              },
              allOption:{
                  notify:true,
                  type:Boolean,
                  value:true
              },
              labelSelect:{
                  notify:true,
                  type:Number,
                  value:0
              },
              selectedLabel: {
                  type: String,
                  value: 'Event'
              },
              mainAnnDataUrl:{
                computed: '_computeMainAnnUrl(vuex.config.apiUrl, vuex.userToken, summary.content.id, activeLayer.*)'
              },
              getAnnDataUrl:{
                computed: '_computeGetAnnUrl(vuex.config.apiUrl, vuex.userToken, summary.content.id)'
              },
              getLayerUrl:{
                computed: '_computeGetLayerUrl(vuex.config.apiUrl, vuex.userToken, summary.content.id)'
              },
              defaultLabels: {
                  notify: true,
                  type: Array,
                  value: ['Event', 'Artifact', 'Seizure', 'Mark', 'Stim On', 'Stim Off', 'Start', 'Stop']
              },
              annLayerInfo: {
                type: Array,
                value: function() {
                  return [];
                },
                notify: true
              }

          },
          behaviors: [
            Blackfynn.IsPluginBehavior,
            Blackfynn.TSAnnotationBehavior,
            Blackfynn.ColorBehavior,
            Blackfynn.LoggerBehavior,
            Blackfynn.AjaxBehavior,
            Blackfynn.ItemIconBehavior,
            Blackfynn.VuexBehavior
          ],

          _computeMainAnnUrl: function(api, user, timeseriesId, layer) {
            let layerId

            if (typeof layer.base === 'number') {
              layerId = layer.base
            } else {
              layerId = layer.base.id
            }

            return `${api}/timeseries/${timeseriesId}/layers/${layerId}/annotations?api_key=${user}`;
          },
          _computeGetAnnUrl: function(api, user, timeseriesId) {
              return `${api}/timeseries/${timeseriesId}/annotations?api_key=${user}`;
          },
          _computeGetLayerUrl: function(api, user, timeseriesId) {
              return `${api}/timeseries/${timeseriesId}/layers?api_key=${user}`
          },
          ready: function() {
          },
          attached: function() {
          }


      });

  </script>
</dom-module>
