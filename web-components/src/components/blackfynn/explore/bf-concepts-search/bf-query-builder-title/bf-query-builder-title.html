<link rel="import" href="../../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../shared/bf-input/bf-input.html">
<link rel="import" href="../bf-query-filter/bf-query-filter.html">

<link rel="import" href="../../../../../styles/blackfynn/main.html">
<link rel="import" href="../../../../../styles/blackfynn/explore.html">

<!--
`bf-query-builder-title`
Query builder title and save button.

@demo demo/index.html
-->

<dom-module id="bf-query-builder-title">
  <template>
    <style include="blackfynn-main-styles"></style>
    <style include="bf-explore-styles"></style>
    <style>
      :host {
        box-sizing: border-box;
        display: block;
        font-size: 13px;
        margin: 0;
      }
      header {
        display: inline;
        padding: 0;
        margin: 18px 0 16px 0;

        @apply(--layout-horizontal);
        @apply(--layout-center);
      }
      .titleWrapper {
        @apply(--layout-flex);
      }
      h1 {
        display: inline-block;
        font-size: 16px;
        line-height: 19px;
        margin: 0 10px 0 0;
      }
      a {
        color: var(--glial);
        text-decoration: none;
      }
      a:hover {
        color: var(--dopamine);
      }
      .save-link {
        color: #000;
      }
      bf-input {
        margin: 0 20px 0 0;
        max-width: 400px;
        width: 100%;
      }
    </style>

    <header>
      <div class="titleWrapper">
        <template is="dom-if" if="[[!_displayTextField]]">
          <h1>{{queryTitle}}</h1>
          <a href="#renameTitle" id="renameLink" on-tap="renameQuery">Rename</a>
        </template>
        <template is="dom-if" if="[[_displayTextField]]">
          <bf-input
            id="conceptTitle"
            placeholder="Enter a Title for your Query"
            hide-label
            autofocus
            value="{{queryTitle}}"
            hidden="[[!isEditing]]"></bf-input>
        </template>
      </div>
      <paper-button
        class="light"
        on-tap="saveQuery"
        noink>Save Results</paper-button>
    </header>

    <iron-a11y-keys
      keys="enter"
      target="[[keyTarget]]"
      on-keys-pressed="saveQuery"></iron-a11y-keys>

  </template>

  <script>
    Polymer({

      is: 'bf-query-builder-title',

      properties: {
        /**
         * Title of query
         */
        queryTitle: {
          type: 'String',
          value: '',
          notify: true
        },
        /**
         * Tracks whether or not query title is being edited
         */
         _isEditing: {
          type: Boolean,
          value: false
         },
         /**
         * Target for keyboard functionality
         */
        keyTarget: {
          type: Object,
          value: function() {
            return this.$.conceptTitle;
          }
        },
        /**
         * Determines whether or not to show the query title text field
         */
        _displayTextField: {
          type: Boolean,
          computed: '_computeDisplayTextField(queryTitle, _isEditing)'
        },
      },

      /**
       * Computes when to display the title text field
       */
      _computeDisplayTextField: function(queryTitle, isEditing) {
        return !queryTitle || queryTitle.length === 0 || isEditing;
      },

      /**
       * Toggles filters visibility
       * @param {Object} evt
       */
      renameQuery: function(evt) {
        evt.preventDefault();
        this.async(() => this.$$('bf-input').$.input.focus(), 100);
        this.set('_isEditing', !this._isEditing);
      },

      /**
       * Fires an event to rename concept query
       */
      saveQuery: function() {
        if (this.queryTitle.length === 0) {
          return;
        }
        this.fire('rename-concept-query', {
          title: this.queryTitle
        });
        this.set('_isEditing', false);
      }

    });
  </script>
</dom-module>
