<link rel="import" href="../../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../state/bf-state-aware-behavior.html">

<link rel="import" href="../../../../vendor-scripts.html">

<script>
  window.Blackfynn = window.Blackfynn || {};
  /**
  * @polymerBehavior
  */

  Blackfynn.ToolsPalettesBehavior = {

    behaviors: [
      StateAwareBehavior
    ],

    properties: {
      /**
       * Tools available for viewers to use
       */
      tools: {
        type: Array,
        value: function() {
          return [
            {
              eventName: 'pan',
              packages: [
                'Slide', 'TimeSeries'
              ],
              icon: 'pan-tool',
              tooltip: 'Pan'
            },
            {
              eventName: 'annotationShape',
              packages: [
                'Slide'
              ],
              icon: 'annotations',
              tooltip: 'Annotate Area'
            },
            {
              eventName: 'annotationDraw',
              packages: [
                'Slide'
              ],
              icon: 'create',
              tooltip: 'Annotate Free Form'
            },
            {
              eventName: 'measure',
              packages: [
                'Slide'
              ],
              icon: 'ruler',
              tooltip: 'Measure'
            },
            {
              eventName: 'annotate',
              packages: [
                'TimeSeries'
              ],
              icon: 'annotations',
              tooltip: 'Annotate'
            }
          ]
        }
      },
      /**
       * Tools that are default to every viewer
       */
      defaultTools: {
        type: Array,
        value: function() {
          return [
            {
              eventName: 'pointer',
              icon: 'mouse-cursor'
            }
          ];
        }
      },
      /**
       * Get list of tools based off of active viewer's package type
       */
      availableTools: {
        type: Array,
        computed: 'getAvailable(activeViewer.data.state, activeViewer.data.packageType, tools, defaultTools)'
      },
      /**
       * Palettes available for viewers to use
       */
      palettes: {
        type: Array,
        value: function() {
          return [
            {
              eventName: 'annotations',
              packages: [
                'Slide', 'TimeSeries'
              ],
              icon: 'annotations',
              tooltip: 'Annotations'
            },
            {
              eventName: 'navigator',
              packages: [
                'Slide'
              ],
              icon: 'navigator',
              tooltip: 'Navigator'
            },
            {
              eventName: 'channels',
              packages: [
                'TimeSeries'
              ],
              icon: 'channels',
              tooltip: 'Channels'
            }
          ]
        }
      },
      /**
       * Palettes that are default to every viewer
       */
      defaultPalettes: {
        type: Array,
        value: function() {
          return [
            {
              eventName: 'infoPanel',
              icon: 'info',
              tooltip: 'Info Panel'
            },
            {
              eventName: 'discussion',
              icon: 'discussion',
              tooltip: 'Discussions'
            },
            {
              eventName: 'fileBrowser',
              icon: 'file-explorer',
              tooltip: 'File Explorer'
            }
          ]
        }
      },
      /**
       * Get list of palettes based off of active viewer's package type
       */
      availablePalettes: {
        type: Array,
        computed: 'getAvailable(activeViewer.data.state, activeViewer.data.packageType, palettes, defaultPalettes)'
      },
      isMppVisible: {
        type: Boolean
      }
    },

    /**
     * Check package type
     * @param {String} packageType
     * @param {Array} item
     */
    checkPackageType: (packageType, item) => R.compose(
      R.indexOf(packageType),
      R.prop('packages')
    )(item),

    /**
     * Create list of available tools based off of active viewer's package type and default tools
     * @param {String} packageType
     * @param {Array} list
     * @param {Array} defaultList
     * @return {Array}
     */
    getAvailable: function(packageState, packageType, list, defaultList) {
      let type = packageType
      if (packageState === 'ERROR') {
        type = 'unknown'
      }
      return R.concat(defaultList, list.filter(item => this.checkPackageType(type, item) > -1));
    }
  }

</script>
