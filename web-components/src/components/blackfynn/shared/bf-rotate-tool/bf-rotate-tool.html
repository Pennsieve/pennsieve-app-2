<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../bf-select-input/bf-select-input.html">
<link rel="import" href="../bf-button-group/bf-button-group.html">

<link rel="import" href="../../../../styles/blackfynn/main.html">
<link rel="import" href="../../../../styles/blackfynn/icons.html">
<link rel="import" href="../../../../vendor-scripts.html">

<!--
`<bf-rotate-tool>` is a component to control rotation.

    <bf-rotate-tool angle="{{angle}}"></bf-rotate-tool>

@element bf-rotate-tool
-->

<dom-module id="bf-rotate-tool">

  <template>
    <style include="blackfynn-main-styles"></style>
    <style type="text/css">
      :host {
        display: block;
      }
      :host([hidden]) {
        display: none;
      }
      .tool-wrap {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        @apply(--layout-flex);
      }
      span {
        width: 50px;
      }
      bf-button-group {
        margin-left: 5px;
      }
    </style>

    <div class="tool-wrap">
      <bf-select-input
        label="Rotation"
        label-icon="blackfynn:rotate"
        items="[[rotationValues]]"
        selected="0"
        value="{{angle}}"
        unit="&deg;"
        dropdown-unit></bf-select-input>

      <bf-button-group>
        <paper-icon-button
          class="icon"
          icon="blackfynn:rotate-left"
          rotation="subtract"
          noink
          on-tap="setAngle"></paper-icon-button>

        <paper-icon-button
          class="icon"
          icon="blackfynn:rotate-right"
          rotation="add"
          noink
          on-tap="setAngle"></paper-icon-button>
      </bf-button-group>

    </div>

  </template>

  <script>

    Polymer({

      is: 'bf-rotate-tool',

      properties: {
        /**
         * Angle
         */
        angle: {
          type: Number,
          value: 0,
          notify: true
        },
        rotationAmount: {
          type: Number,
          value: 10
        },
        rotationValues: {
          type: Array,
          value: function() {
            return [
              {
                label: 0,
                value: 0
              },
              {
                label: 45,
                value: 45
              },
              {
                label: 90,
                value: 90
              },
              {
                label: 135,
                value: 135
              },
              {
                label: 180,
                value: 180
              },
              {
                label: 225,
                value: 225
              },
              {
                label: 270,
                value: 270
              },
              {
                label: 315,
                value: 315
              }
            ]
          }
        }
      },

      /**
       * Set angle
       * @param {Object} Event
       */
      setAngle: function(e) {
        const rotationAmount = this.get('rotationAmount');
        const rotation = e.currentTarget.getAttribute('rotation');

        let angle = R[rotation](this.get('angle'), rotationAmount);

        if(angle < 0) {
          angle = 360 - rotationAmount;
        } else if(angle >= 360) {
          angle = 0;
        }

        this.set('angle', Math.abs(angle));
      }

    });

  </script>

</dom-module>
