<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../user-menu/user-menu.html">
<link rel="import" href="../../shared/bf-icon-circle/bf-icon-circle.html">
<link rel="import" href="../../state/bf-state-aware-behavior.html">
<link rel="import" href="../../upload/bf-upload-status-window.html">

<link rel="import" href="../../../../styles/blackfynn/icons.html">
<link rel="import" href="../../../../styles/blackfynn/main.html">

<link rel="import" href="../../../../config/config.html">
<link rel="import" href="./bf-aux-menu-window.html">

<!--
## bf-aux-menu

`<bf-aux-menu>` is the auxiliary menu within datasets and collections that allows
users to access their profile, upload files, create new collections, and create new datasets.

@element bf-aux-menu
@demo ./demo/index.html
-->

<dom-module id="bf-aux-menu">
  <template>
    <style include="blackfynn-main-styles"></style>
    <style>
      :host {
        height: 100%;
        min-width: 190px;
        position: relative;
        @apply(--layout-center);
        @apply(--layout-end-justified);
        @apply(--layout-flex);
        @apply(--layout-horizontal);
      }
      .aux-item {
        margin-right: 15px;
      }
      #btnUploadStatus {
        cursor: pointer;
      }
      #newDatasetButton, #newButton {
        border: solid 1px transparent;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        height: 36px;
        line-height: 17px;
        margin-right: 15px;
        outline: 0;
        padding: 0 28px;
        transition: background .2s ease-in-out;
      }
      #dataCatalogButtons {
        @apply(--layout-inline);
      }
      #btnUploadStatus[animated] iron-icon {
        animation: uploadIconAnimation .75s linear infinite alternate;
      }
      @keyframes uploadIconAnimation {
        from {
          color: #666;
          opacity: 1
        }
        to {
          color: var(--app-primary-color);
          opacity: .8
        }
      }
    </style>

    <div id="dataCatalogButtons" hidden$="[[!isDataCatalogView]]">
      <button
        hidden$="[[!isDatasetsView]]"
        id="newDatasetButton"
        type="button"
        on-tap="toggleCreateDataset"
        class="primary">New Dataset</button>

      <button
        hidden$="[[isDatasetsView]]"
        id="newButton"
        type="button"
        on-tap="toggleMenu"
        opened$="[[isOpen]]"
        class="primary">New...</button>

      <bf-aux-menu-window
        id="newWindow"
        opened="{{isOpen}}"
        position-target="[[_this]]"></bf-aux-menu-window>
    </div>

    <bf-icon-circle
      id="btnUploadStatus"
      class="aux-item"
      on-tap="toggleUploadStatusOpen"
      animated$="[[isUploading]]"><iron-icon icon="blackfynn:upload"></iron-icon></bf-icon-circle>

    <bf-upload-status-window id="uploadStatusWindow" is-uploading="[[isUploading]]"></bf-upload-status-window>

    <blackfynn-user-menu id="userMenu"></blackfynn-user-menu>
  </template>

  <script>
  Polymer({
    is: 'bf-aux-menu',

    behaviors: [
      Blackfynn.Config,
      StateAwareBehavior
    ],

    properties: {
      /**
       * determines whether or not package is a dataset
       */
      isDatasetsView: {
        type: Boolean,
        computed: '_computeIsDatasetsView(state.dataView)'
      },
      /**
       * determines whether or not package is a dataset
       */
      isDataCatalogView: {
        type: Boolean,
        computed: '_computeIsDataCatalogView(state.appView)'
      },
      _this: {
        type: Object,
        value: function() {
          return this;
        }
      }
    },

    /**
     * Check if user is viewing root Data Catalog
     * @param {String} dataView
     * @returns {Boolean}
     */
    _computeIsDatasetsView: function(dataView) {
      return dataView === 'datasets';
    },

    /**
     * Check if user is viewing a collection
     * @param {String} appView
     * @returns {Boolean}
     */
     _computeIsDataCatalogView: function(appView) {
      return appView === 'data-catalog';
    },

    /**
     * Toggles auxiliary window visibility
     */
    toggleMenu: function() {
      this.$.newWindow.toggle();
    },

    /**
     * Dispatches event to data-catalog view to toggle create dataset modal
     */
    toggleCreateDataset: function() {
      this.fire('data-catalog-event', {
        methodName: 'openDatasetDialog'
      });
    },

    /**
     * Dispatches event to toggle upload status
     */
    toggleUploadStatusOpen: function() {
      this.fire('toggle-upload-status-open', { el: this.$.btnUploadStatus });
    },

    /**
     * Close header overlays
     */
    closeHeaderOverlays: function() {
      this.$.newWindow.close();
      this.$.userMenu.$.userWindow.close();
    }

  });
  </script>
</dom-module>
