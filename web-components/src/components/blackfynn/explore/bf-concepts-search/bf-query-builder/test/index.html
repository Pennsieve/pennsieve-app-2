<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>bf-query-builder test</title>

    <script src="../../../../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="../bf-query-builder.html">
  </head>
  <body>

    <test-fixture id="basic">
      <template is="dom-template">
        <bf-query-builder query-filters="[[queryFilters]]" initial-concept="[[initialConcept]]"></bf-query-builder>
      </template>
    </test-fixture>

    <script>
      suite('basic', () => {
        let basic;
        let _handleRelatedFieldsSpy;
        let _handleRenameQuerySpy;

        setup(() => {
          basic = fixture('basic', {
            initialConcept: 'Animal',
            queryFilters: [
              {
                conceptType: 'Animal',
                properties: [
                  {
                    name: 'ID',
                    value: 'id'
                  },
                  {
                    name: 'Name',
                    value: 'name'
                  }
                ]
              },
              {
                conceptType: 'Study',
                properties: [
                  {
                    name: 'Name',
                    value: 'name'
                  },
                  {
                    name: 'Protocol ID',
                    value: 'protocol id'
                  }
                ]
              }
            ]
          });
          _handleRelatedFieldsSpy = sinon.stub(basic, '_handleRelatedFieldsUpdate', () => {});
          _handleRenameQuerySpy = sinon.stub(basic, '_handleRenameConceptQuery', () => {});
        });

        teardown(() => {
          _handleRelatedFieldsSpy.restore();
        });

        test('instantiating the element works', () => {
          assert.equal(basic.is, 'bf-query-builder');
        });

        test('initialConcept is correct', () => {
          assert.equal(basic.initialConcept, 'Animal');
        });

        test('addFilter method adds new filter to filterQueries array', () => {
          expect(basic.queryFilters.length).to.be.equal(2);
          basic.addFilter();
          expect(basic.queryFilters.length).to.be.equal(3);
        });

        test('Handles remove-concept-filter custom event', () => {
          expect(basic.queryFilters.length).to.be.equal(2);
          basic.addEventListener('remove-concept-filter', () => {
            expect(basic.queryFilters.length).to.be.equal(1);
          });
          basic.fire('remove-concept-filter', 1);
        });

        test('Handles update-related-fields event', () => {
          basic.addEventListener('update-related-fields', () => {
            expect(_handleRelatedFieldsSpy).to.have.been.calledOnce;
          });
          basic.fire('update-related-fields', {
            conceptType: 'Study',
            index: 0
          });
        });

        test('Handles rename-concept-query event', () => {
          basic.addEventListener('rename-concept-query', () => {
            expect(_handleRenameQuerySpy).to.have.been.calledOnce;
          });
          basic.fire('rename-concept-query', {
            title: 'Cats in Philadelphia',
          });
        });
      });
    </script>

  </body>
</html>
