<link rel="import" href="../../../../../bower_components/polymer/polymer.html">

<script>
  window.Blackfynn = window.Blackfynn || {};
  /**
  * @polymerBehavior
  */

  Blackfynn.ViewerDragBehavior = {

    listeners: {
      'dragstart': '_toggleDrag'
    },

    /**
     * toggles is-dragging property true/false
     */
    _toggleDrag: function() {
      this.fire('toggle-is-dragging');
    },

    /**
     * When the user first drags into an item
     * @param {Event} evt
     */
    _onDragEnter: function(evt) {
      evt.target.parentNode.classList.add('drag-over');
    },

    /**
     * When the user drags over an item
     * @param {Event} evt
     */
    _onDragOver: function(evt) {
      evt.preventDefault();
      evt.dataTransfer.dropEffect = 'move';
    },

    /**
     * When user releases dragged item
     * @param {Event} evt
     */
    _onDrop: function(evt) {
      // stopped dragging
      this._toggleDrag();

      const parent = R.path(['target', 'parentNode'], evt);
      // Remove style from dropTarget
      parent.classList.remove('drag-over');

      const dragData = evt.dataTransfer.getData('dragData');
      // Check for locations where item cannot be dragged into
      if (!dragData) {
        return;
      }

      // Prevent default action from browser
      evt.preventDefault();
      // Prevent Bubbling to Window
      evt.stopPropagation();

      // Parse data string
      const parsedData = JSON.parse(dragData);
      const data = parsedData && parsedData[0];

      // open new package in viewer
      if (data.content.state !== 'READY' || data.content.packageType === 'Collection') {
        return;
      }
      // Open item
      this.fire('open-viewer', { item: data, target: parent });
    }
  }
</script>
