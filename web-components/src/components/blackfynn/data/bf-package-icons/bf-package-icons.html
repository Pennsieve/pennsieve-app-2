<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/app-route/app-route.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../../../bower_components/paper-spinner/paper-spinner-lite.html">

<link rel="import" href="../../../../styles/blackfynn/icons.html">
<link rel="import" href="../../../../styles/blackfynn/main.html">
<link rel="import" href="../../../../styles/blackfynn/browse.html">
<link rel="import" href="../../../../styles/blackfynn/data-item.html">
<link rel="import" href="../bf-package-behavior/bf-package-behavior.html">
<link rel="import" href="../bf-data-icon/bf-data-icon.html">
<link rel="import" href="../bf-collection-dialog/bf-collection-dialog.html">
<link rel="import" href="../drag-info.html">
<link rel="import" href="../bf-data-item-behavior.html">
<link rel="import" href="../bf-empty-dataset/bf-empty-dataset.html">
<link rel="import" href="../../state/bf-state-aware-behavior.html">
<link rel="import" href="../../../../vendor-scripts.html">
<link rel="import" href="../../shared/bf-ajax-behavior.html">

<!--
## bf-package-icons

`<bf-package-icons>` is a list of 2x2 icons of all packages.
-->

<dom-module id="bf-package-icons">

  <template>
    <style include="blackfynn-main-styles"></style>
    <style include="blackfynn-browse-styles"></style>
    <style include="bf-data-item-styles"></style>
    <style type="text/css">
      :host {
        @apply(--layout-flex);
        @apply(--layout-vertical);
      }
      .load-wrap {
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-center-justified);
        @apply(--layout-flex);
      }
      .is-empty-wrap {
        padding: 15px 0 0 30px;
      }
      #iconsContent {
        height: calc(100vh - 160px);
        overflow-y: scroll;
        overflow-x: hidden;
        @apply(--layout);
        @apply(--layout-wrap);
      }
      bf-data-icon {
        flex: 0 0 50%;
      }
    </style>

    <div id="iconsContent" hidden$="[[isLoading]]">

      <bf-empty-dataset
        is-empty="[[isEmpty]]"
        packages="[[packages]]"
        catalog-route="[[catalogRoute]]"></bf-empty-dataset>

      <template is="dom-repeat" items="{{packages}}" sort="[[_sort(sortBy, sortDirection)]]">
        <bf-data-icon
          data="{{item}}"
          selected="[[selected]]"
          draggable="true"
          cur-package="[[curPackage]]"
          node-types="[[state.nodeTypes]]"></bf-data-icon>
      </template>

    </div>

    <div class="load-wrap" hidden$="[[!isLoading]]">
      <paper-spinner-lite id="browseLoading" active></paper-spinner-lite>
    </div>

    <blackfynn-data-drag-info
      id="dragInfo"
      length="[[selected.length]]"
      name="[[dragName]]"
      hidden="[[dragInfoHidden]]">
    </blackfynn-data-drag-info>

    <bf-collection-dialog
      id="createCollection"
      cur-package="[[curPackage]]"
      opened="{{createCollectionOpen}}"
      packages="[[packages]]"
      selected-item="[[selected]]">
    </bf-collection-dialog>

    <iron-ajax
      auto$="[[isAuto]]"
      id="getCollectionData"
      method="GET"
      content-type="application/json"
      handle-as="json"
      loading="{{isLoadingCollection}}"
      url="[[_getCollectionDataUrl]]"
      on-response="_handleGetCollectionData"
      on-error="ajaxError">
    </iron-ajax>

    <iron-ajax
      id="moveItem"
      method="POST"
      content-type="application/json"
      handle-as="json"
      url="[[moveItemUrl]]"
      on-response="_handleMoveItem"
      on-error="ajaxError">
    </iron-ajax>

    <app-route
      route="{{catalogRoute}}"
      pattern="/:id"
      data="{{catalogRouteData}}">
    </app-route>
  </template>

  <script>
    Polymer({
      is: 'bf-package-icons',

      behaviors: [
        Blackfynn.DataItemBehavior,
        Blackfynn.AjaxBehavior,
        Blackfynn.DataPackageBehavior,
        StateAwareBehavior
      ],

    });

  </script>

</dom-module>
