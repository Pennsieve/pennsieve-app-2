<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/paper-spinner/paper-spinner-lite.html">

<link rel="import" href="../../../../styles/blackfynn/main.html">

<!--
## bf-chart-tooltip

`<bf-chart-tooltip>` is a component to display information about an annotation.

@demo
-->

<dom-module id="bf-chart-tooltip">

  <template>
    <style include="blackfynn-main-styles"></style>
    <style>
      :host {
        background: var(--white-matter);
        border: 1px solid #979797;
        font-family: 'FiraSans', sans-serif;
        padding: 17px 10px 10px;
        position: absolute;
        width: 240px;
        @apply(--layout-vertical);
      }
      :host::after, :host::before {
        border-color: transparent;
        border-style: solid;
        content: '';
        height: 0;
        position: absolute;
        width: 0;
      }
      :host::after {
        border-top-color: #ffffff;
      }
      :host::before {
        border-top-color: #808080;
      }
      :host([position="left"])::after, :host([position="left"])::before {
        border-width: 18px 18px 0 0;
        bottom: -18px;
        left: 0;
      }
      :host([position="left"])::before {
        border-width: 20px 20px 0 0;
        bottom: -20px;
        left: -1px;
      }
      :host([position="right"])::after, :host([position="right"])::before {
        border-width: 18px 0 0 18px;
        bottom: -18px;
        right: 0;
      }
      :host([position="right"])::before {
        border-width: 20px 0 0 20px;
        bottom: -20px;
        right: -1px;
      }
      :host([position="left-bottom"])::after, :host([position="right-bottom"])::after {
        border-bottom-color: #ffffff;
      }
      :host([position="left-bottom"])::before, :host([position="right-bottom"])::before {
        border-bottom-color: #808080;
      }
      :host([position="left-bottom"])::after, :host([position="left-bottom"])::before {
        border-width: 0 18px 18px 0;
        top: -18px;
        left: 0;
      }
      :host([position="left-bottom"])::before {
        border-width: 0 20px 20px 0;
        top: -20px;
        left: -1px;
      }
      :host([position="right-bottom"])::after, :host([position="right-bottom"])::before {
        border-width: 0 0 18px 18px;
        top: -18px;
        right: 0;
      }
      :host([position="right-bottom"])::before {
        border-width: 0 0 20px 20px;
        top: -20px;
        right: -1px;
      }
      h2 {
        font-size: 14px;
        font-weight: 500;
        margin: 0;
      }
      p {
        margin: 0 0 10px;
      }
      .datetime {
        color: #9B9B9B
      }
      ::slotted([slot="button-wrap"]) {
        margin-top: 14px;
        @apply(--layout-horizontal);
      }
      ::slotted([slot="button-wrap"]) paper-button {
        margin: 0 10px 0 0;
        padding-left: 10px;
        padding-right: 10px;
        @apply(--layout-flex)
      }
      ::slotted([slot="button-wrap"]) paper-button:last-child {
        margin-right: 0;
      }
      paper-spinner-lite {
        @apply(--layout-self-center);
        @apply(--layout-center-justified);
      }
    </style>

    <div hidden$="[[loading]]">
      <h2>[[annotation.name]]</h2>
      <p>[[annotation.description]]</p>
      <span class="datetime">[[timestamp]]</span>

      <slot name="button-wrap"></slot>
    </div>

    <paper-spinner-lite active$="[[loading]]" hidden$="[[!loading]]"></paper-spinner-lite>


  </template>

  <script>

    Polymer({
      is: 'bf-chart-tooltip',

      properties: {
        /**
         * Annotation to display info about
         */
        annotation: {
          type: Object,
          value: function() {
            return {
              id: 0,
              data: {},
              timeSeriesId: 'string',
              channelIds: [],
              layerId: 0,
              name: 'string',
              label: 'string',
              description: 'string',
              userId: 'string',
              start: 0,
              end: 0
            }
          }
        },
        /**
         * Position of the annotation for styling
         */
        position: {
          type: String,
          reflectToAttribute: true,
          value: 'left'
        },
        /**
         * Position of the annotation for styling
         */
        timestamp: {
          type: String,
          computed: '_computeTimestamp(annotation.start)'
        },
        /**
         * The tooltip content is loading
         */
        loading: {
          type: Boolean,
          value: false
        }
      },

      /**
       * Turn timestamp into human readable string
       */
      _computeTimestamp: function(start) {
        return new Date(start/1000).toUTCString();
      }
    });

  </script>

</dom-module>
