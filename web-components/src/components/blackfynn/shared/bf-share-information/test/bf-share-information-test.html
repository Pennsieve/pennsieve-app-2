<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>

  <title>bf-share-information tests</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">

  <script src="../../../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../../../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../bf-share-information.html">
</head>
<body>

  <test-fixture id="basic">
    <template is="dom-template">
      <bf-share-information
        collaborators="[[collaborators]]"
        item="[[item]]"
        active-organization="[[activeOrganization]]"
        is-owner="[[isOwner]]"
        views="[[views]]"></bf-share-information>
    </template>
  </test-fixture>

  <script>
    suite('basic', function() {
      const collaborators = {
        users: [
          {
            id: 'N:user:1',
            email: 'christian@blackfynn.com',
            password: '****',
            firstName: 'Christian',
            lastName: 'Lohr',
            organization: 'Blackfynn',
            credential: 'Front-end Engineer',
            color: '#342E37',
            url: 'http://www.blackfynn.com'
          },
          {
            id: 'N:user:2',
            email: 'chris@blackfynn.com',
            password: '****',
            firstName: 'Chris',
            lastName: 'Baglieri',
            organization: 'Blackfynn',
            credential: 'VP Engineering',
            color: '#4C212A',
            url: 'www.blackfynn.com'
          },
          {
            id: 'N:user:3',
            email: 'rohan@blackfynn.com',
            password: '****',
            firstName: 'Rohan',
            lastName: 'Shah',
            organization: '',
            credential: 'VIP Engineering',
            color: '#DF2935',
            url: 'zombo.co'
          }
        ],
        organizations: [],
        teams: []
      };

      const newCollaborator = {
        id: 'N:user:4',
        email: 'newuser@blackfynn.com',
        password: '****',
        firstName: 'New',
        lastName: 'User',
        organization: 'Blackfynn',
        credential: 'Front-end Engineer',
        color: '#342E37',
        url: 'http://www.blackfynn.com'
      };

      const isOwner = true;

      const state = {
        profile: {
          id: 'N:user:5',
          firstName: 'Cameron',
          lastName: 'Baney'
        }
      };

      const activeOrganization = {
        organization: {
          id: 'N:organization:xxxx-xxxx',
          name: 'Blackfynn',
          slug: 'blackfynn'
        },
        isAdmin: true,
        owners: [],
        isOwner: false
      }

      const item = {
        content: {
          id: 'N:dataset:fb5d6a93-15ef-40a2-bbaf-41cd2433eb3d',
          name: 'Shared Dataset',
          description: 'My description',
          packageType: 'DataSet',
          state: 'READY'
        },
        properties: [
          {
            category: 'Blackfynn',
            properties: []
          }
        ],
        children: [],
        owner: 'N:user:2e4e659b-729c-4510-9918-40807105e3fb',
        ancestors: [],
        collaboratorCounts: {
          users: 3,
          groups: 0
        }
      };

      const maxCollaboratorsShown = 2;

      const views = {
        private: false,
        people: true,
        organization: false
      };

      const setupComponent = (name) => {
        const test = fixture(name);
        test.state = state;
        test.isOwner = isOwner;
        test.activeOrganization = activeOrganization;
        test.item = item;

        // Prevent iron-ajax from firing
        const ajax = Polymer.dom(test.root).querySelector('#getCollaborators');
        ajax.removeAttribute('auto');

        return test;
      };

      test('Should have 2 extra collaborators in overflow', function() {
        const test = setupComponent('basic');
        test.set('maxCollaboratorsShown', 2);
        test.collaborators = collaborators;

        expect(test.hasOverflow).to.be.true;
        expect(test._collaboratorsTrimmed.extra, 2).to.be.equal;
      });

      test('Able to add a collaborator', function() {
        const test = setupComponent('basic');
        test.collaborators = collaborators;

        expect(test._collaboratorsTrimmed.items.length, 4).to.be.equal;

        test.push('collaborators.users', newCollaborator);
        expect(test._collaboratorsTrimmed.items.length, 5).to.be.equal;
      });

      test('Should be a private dataset by default', function() {
        const test = setupComponent('basic');
        test.collaborators = { users: [], teams: [], organizations: []}

        expect(test.views.private).to.be.true;
        expect(test.shareLinkText, 'Share this dataset with others').to.be.equal;

      });

      test('Should be private is all collaborators are removed', function() {
        const test = setupComponent('basic');
        test.collaborators = collaborators;

        expect(test.views.people).to.be.true;

        test.splice('collaborators.users', 0, test.collaborators.users.length);
        expect(test.views.private).to.be.true;

      });
    });
  </script>

</body>
</html>
