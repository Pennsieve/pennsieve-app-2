<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">

<link rel="import" href="../../data/item-label.html">
<link rel="import" href="../../shared/bf-dialog/bf-dialog.html">
<link rel="import" href="../../shared/patched-overlay-behavior.html">

<link rel="import" href="../../../../styles/blackfynn/main.html">
<link rel="import" href="../../../../vendor-scripts.html">

<!--
## bf-annotation-delete

`<bf-annotation-delete>` is a modal window component to confirm the deletion an annotation.

@demo
-->

<dom-module id="bf-annotation-delete">

  <template>
    <style include="blackfynn-main-styles"></style>
    <style>
      :host {
        display: block;
      }
      strong {
        margin-left: 20px;
      }
      paper-button.delete {
        margin-right: 4px;
      }
      .cancel {
        margin-right: 10px;
      }
    </style>

    <bf-dialog id="annDeleteDialog" opened="{{opened}}" processing="[[processing]]" on-iron-overlay-opened="patchOverlay" closing-reason="{{closingReason}}">
      <h2 slot="heading">Confirm Delete</h2>
      <div slot="body">
        <span hidden$="[[!withDiscussions]]">
          Deleting this annotation will also remove any associated discussions and cannot be undone. Are you sure you
          would like to remove this annotation?
        </span>
        <span hidden$="[[withDiscussions]]">
          <p>Are you sure you want to delete:</p>
          <strong>[[annotationDisplayName]]</strong>
        </span>
      </div>
      <div slot="buttons">
        <span hidden$="[[!withDiscussions]]">
          <paper-button class="delete" noink dialog-confirm>Cancel</paper-button>
          <paper-button class="save" noink dialog-confirm autofocus on-tap="deleteAnn">Yes, I'm sure</paper-button>
        </span>
        <span hidden$="[[withDiscussions]]">
          <paper-button
            class="cancel"
            noink
            hidden$="[[processing]]"
            dialog-confirm>Cancel</paper-button>
          <paper-button class="delete" noink dialog-confirm autofocus on-tap="deleteAnn">Delete</paper-button>
        </span>
      </div>
    </bf-dialog>

  </template>

  <script>

    Polymer({
      is: 'bf-annotation-delete',

      behaviors: [
        Blackfynn.PatchedOverlayBehavior
      ],

      properties: {
        /**
         * annotation display name
         */
        annotationDisplayName: {
          type: 'String',
          computed: '_computeAnnDisplayName(annotation)'
        },
        /**
         * annotation to delete
         */
        annotation: {
          type: Object,
          value: function() {
            return {};
          }
        },
        /**
         * reference to the component that has the delete annotation function
         */
        selector: {
          type: Object,
          value: function() {
            return {};
          }
        },
        /**
         * Contains the reason(s) this overlay was last closed (see `iron-overlay-closed`). `IronOverlayBehavior` provides the canceled reason.
         */
        closingReason: {
          type: Object,
          value: function() {
            return {};
          }
        },
        /**
         * List of annotations sans the one to delete
         */
        annotations: {
          type: Array,
          value: function() {
            return [];
          }
        },
        /**
         * Option to remove associated discussions with annotation
         */
         withDiscussions: {
          type: Boolean,
          value: false
        }
      },

      listeners: {
        'iron-overlay-closed': 'onDialogClose'
      },

      /**
       * Computes the annotation display name
       * @param {Object} annotation
       */
      _computeAnnDisplayName: function(annotation) {
        const description = R.propOr('', 'description', annotation);
        const label = R.propOr('', 'label', annotation);
        return description && description.length > 0 ? description : label;
      },

      /**
       * iron-overlay-closed handler
       */
      onDialogClose: function() {
       // Reset
        this.set('closingReason', {});
      },

      /**
       * delete annotation
       */
       deleteAnn: function() {
        this.fire('confirmed-delete-annotation', {
          annotation: this.annotation,
          annotations: this.annotations,
          withDiscussions: this.withDiscussions
        });
      }

    });

  </script>
</dom-module>
