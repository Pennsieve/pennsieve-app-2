<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../shared/bf-viewer-package-title.html">
<link rel="import" href="../../shared/show-pkg-title-behavior.html">
<link rel="import" href="../../data/bf-viewer/bf-activer-viewer-behavior.html">

<link rel="import" href="../static-viewer-behavior.html">

<dom-module id="bf-viewer-image">
  <template>
    <style type="text/css">
      :host {
        overflow-y: auto;
        overflow-x: hidden;
        width: 100%;
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-flex);
      }
      img {
        display: block;
        height: auto;
        max-width: 100%;
      }
      @-moz-document url-prefix() {
        /* Firefox doesn't respect max-width in certain situations */
        img { width: 100%; max-width: -moz-max-content; }
      }
    </style>
    <template is="dom-if" if="[[showPkgTitle]]">
      <bf-viewer-package-title
        is-active="[[isActive]]"
        title="[[data.name]]"></bf-viewer-package-title>
    </template>

    <img hidden="[[isLoadingViewerData]]" src="[[getFileUrl]]"></img>

    <iron-ajax
      auto
      id="getViewerData"
      method="GET"
      url="[[getViewerDataUrl]]"
      loading="{{isLoadingViewerData}}"
      content-type="application/json"
      handle-as="json"
      on-response="_handleGetViewerData"
      on-error="ajaxError"></iron-ajax>

  </template>

  <script>
    Polymer({
      is: 'bf-viewer-image',

      behaviors: [
        Blackfynn.StaticViewerBehavior,
        Blackfynn.ShowPkgTitleBehavior,
        Blackfynn.ActiveViewerBehavior
      ],

      ajaxError: function(e, detail) {
        this.fire('ajaxError', { status: detail.request.status });
      }
    });
  </script>
</dom-module>
