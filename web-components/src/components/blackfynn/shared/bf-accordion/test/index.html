<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>bf-accordion test</title>

    <script src="../../../../../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../../../../../bower_components/web-component-tester/browser.js"></script>

    <link rel="import" href="../bf-accordion.html">
  </head>
  <body>

    <test-fixture id="basic">
      <template is="dom-template">
        <bf-accordion id="accordion">
          <h2 slot="title">This is my Title</h2>
          <ul slot="items">
            <template is="dom-repeat" items="[[items]]">
              <li>Item #[[item]]</li>
            </template>
          </ul>
        </bf-accordion>
      </template>
    </test-fixture>

    <test-fixture id="icon">
      <template is="dom-template">
        <bf-accordion id="accordionIcon" icon="blackfynn:chevron-down-small">
          <h2 slot="title">This is my Title</h2>
          <ul slot="items">
            <template is="dom-repeat" items="[[items]]">
              <li>Item #[[item]]</li>
            </template>
          </ul>
        </bf-accordion>
      </template>
    </test-fixture>

    <test-fixture id="border">
      <template is="dom-template">
        <bf-accordion id="accordionBorder" border-color="#ff00ff">
          <h2 slot="title">This is my Title</h2>
          <ul slot="items">
            <template is="dom-repeat" items="[[items]]">
              <li>Item #[[item]]</li>
            </template>
          </ul>
        </bf-accordion>
      </template>
    </test-fixture>

    <script>
      suite('bf-accordion', function() {
        let basic;
        const evt = {
          preventDefault: () => {}
        };

        setup(function() {
          basic = fixture('basic', {
            items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
          });
        });

        test('instantiating the element works', function() {
          assert.equal(basic.is, 'bf-accordion');
        });

        test('element items are hidden by default', function(done) {
          assert.equal(basic.opened, false);
          flush(function() {
            const list = basic.querySelector('ul');
            const display = getComputedStyle(list).display;
            assert.equal(display, 'none');
            done();
          });
        });

        test('element can be toggled open', function(done) {
          flush(function() {
            basic.toggle(evt);
            basic.async(() => {
              assert.equal(basic.hasAttribute('opened'), true);
              assert.equal(basic.opened, true);
              done();
            }, 500);
          });
        });

        test('element opened can be toggled closed', function(done) {
          basic.set('opened', true);
          flush(function() {
            basic.toggle(evt);
            basic.async(() => {
              assert.equal(basic.hasAttribute('opened'), false);
              assert.equal(basic.opened, false);
              done();
            });
          });
        });

        test('element does not display an icon', function(done) {
          flush(function() {
            const iconElement = Polymer.dom(basic.root).querySelectorAll('iron-icon[hidden]');
            assert.equal(iconElement.length, 1);
            done();
          });
        });
      });

      suite('bf-accordion w/ icon', function() {
        let icon;

        setup(function() {
          icon = fixture('icon', {
            items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
          });
        });

        test('element does display an icon', function(done) {
          flush(function() {
            const iconElement = icon.querySelectorAll('iron-icon[hidden]');
            assert.equal(iconElement.length, 0);
            done();
          });
        });

        test('_computeIsIconHidden', function() {
          const hasIcon = icon._computeIsIconHidden('bf-icon');
          assert.equal(hasIcon, false);

          const emptyIcon = icon._computeIsIconHidden('');
          assert.equal(emptyIcon, true);

          const nullIcon = icon._computeIsIconHidden(null);
          assert.equal(nullIcon, true);
        });
      });

      suite('bf-accordion w/ border styles', function() {
        let border;

        setup(function() {
          border = fixture('border', {
            items: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
          });
        });

        test('_computeToggleStyles', function() {
          const hasBorder = border._computeToggleStyles('blue');
          assert.equal(hasBorder, 'border-left: solid 5px blue;');

          const emptyStr = border._computeToggleStyles('');
          assert.equal(emptyStr, '');

          const nullValue = border._computeToggleStyles('');
          assert.equal(nullValue, '');
        });
      });
    </script>

  </body>
</html>
